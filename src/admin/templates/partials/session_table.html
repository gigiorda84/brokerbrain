<div class="px-6 py-3 border-b border-gray-200 flex justify-between items-center">
    <span class="text-sm text-gray-500">{{ total }} sessioni totali &mdash; Pagina {{ page }} di {{ total_pages }}</span>
</div>

{% if sessions %}
<table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
        <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Utente</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Stato</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Esito</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tipo impiego</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Avviata</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Msg</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Durata</th>
        </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
        {% for s in sessions %}
        <tr class="hover:bg-gray-50 cursor-pointer" onclick="window.location='/admin/session/{{ s.id|string|truncate(8, True, '') }}'">
            <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-600">{{ s.id|string|truncate(8, True, '') }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800">{{ s.user.first_name if s.user and s.user.first_name else '-' }}</td>
            <td class="px-6 py-4 whitespace-nowrap">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                    {% if s.outcome is none %}bg-blue-100 text-blue-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                    {{ s.current_state }}
                </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
                {% if s.outcome == 'qualified' %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Qualificato</span>
                {% elif s.outcome == 'abandoned' %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">Abbandonato</span>
                {% elif s.outcome == 'not_eligible' %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">Non idoneo</span>
                {% elif s.outcome == 'human_escalation' %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">Escalation</span>
                {% elif s.outcome %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">{{ s.outcome }}</span>
                {% else %}
                <span class="text-sm text-gray-400">in corso</span>
                {% endif %}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{ s.employment_type or '-' }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{ s.started_at|datetime }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{ s.message_count }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{ s.started_at|duration }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Pagination -->
{% if total_pages > 1 %}
<div class="px-6 py-4 border-t border-gray-200 flex justify-between items-center">
    <div class="flex space-x-1">
        {% if page > 1 %}
        <a href="/admin/sessions?page={{ page - 1 }}&outcome={{ outcome }}&employment_type={{ employment_type }}"
           class="px-3 py-2 text-sm rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50"
           hx-get="/admin/partials/sessions?page={{ page - 1 }}&outcome={{ outcome }}&employment_type={{ employment_type }}"
           hx-target="#sessions-table"
           hx-swap="innerHTML">Prec.</a>
        {% endif %}
        {% for p in pages %}
        <a href="/admin/sessions?page={{ p }}&outcome={{ outcome }}&employment_type={{ employment_type }}"
           class="px-3 py-2 text-sm rounded-md border {{ 'bg-blue-600 text-white border-blue-600' if p == page else 'border-gray-300 text-gray-700 hover:bg-gray-50' }}"
           hx-get="/admin/partials/sessions?page={{ p }}&outcome={{ outcome }}&employment_type={{ employment_type }}"
           hx-target="#sessions-table"
           hx-swap="innerHTML">{{ p }}</a>
        {% endfor %}
        {% if page < total_pages %}
        <a href="/admin/sessions?page={{ page + 1 }}&outcome={{ outcome }}&employment_type={{ employment_type }}"
           class="px-3 py-2 text-sm rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50"
           hx-get="/admin/partials/sessions?page={{ page + 1 }}&outcome={{ outcome }}&employment_type={{ employment_type }}"
           hx-target="#sessions-table"
           hx-swap="innerHTML">Succ.</a>
        {% endif %}
    </div>
</div>
{% endif %}

{% else %}
<div class="p-6 text-center text-gray-500 text-sm">Nessuna sessione trovata.</div>
{% endif %}
